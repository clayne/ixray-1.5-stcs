#include "common.h"

//	TODO: DX10: move to load instead of sample (will need to provide integer texture coordinates)
#define EPS	(0.9f/255.f)
#define CLIP_THRESHOLD	(1.0f/255.f)
half4 main ( p_TL I ) : SV_Target
{
  	// Sample the fat framebuffer:
  	//half4	NH		= tex2D( s_normal, I.Tex0); 
	half4	NH		= s_normal.Sample( smp_nofilter, I.Tex0 );
  	half	L 		= NH.w * dot( Ldynamic_dir, (half3)NH ) + EPS; // Use hemisphere as approximation of max light

	clip(L-CLIP_THRESHOLD);

  	return	half4( L, L, L, L );
}
