#include "common.h"

#ifndef ISAMPLE
#define ISAMPLE 0
#endif

uniform float3x4	m_v2w;

#include "ssao.ps"

struct	_input
{
	float4	tc0		: TEXCOORD0;	// tc.xy, tc.w = tonemap scale
	float2	tcJ		: TEXCOORD1;	// jitter coords
	float4	pos2d	: SV_Position;
};

float4 main ( _input I ) : SV_Target0
{
	gbuffer_data gbd = gbuffer_load_data( GLD_P(I.tc0, I.pos2d, ISAMPLE) );

	float4	P = float4( gbd.P, gbd.mtl );	// position.(mtl or sun)
	float4	N = float4( gbd.N, gbd.hemi );		// normal.hemi

	float occ = calc_ssao( CS_P(P, N, I.tc0, I.tcJ, I.pos2d, ISAMPLE) );

	return  float4(occ, P.z, 0, 0);
}
